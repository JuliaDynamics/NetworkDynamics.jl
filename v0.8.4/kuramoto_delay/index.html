<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Delay differential equations · NetworkDynamics</title><meta name="title" content="Delay differential equations · NetworkDynamics"/><meta property="og:title" content="Delay differential equations · NetworkDynamics"/><meta property="twitter:title" content="Delay differential equations · NetworkDynamics"/><meta name="description" content="Documentation for NetworkDynamics."/><meta property="og:description" content="Documentation for NetworkDynamics."/><meta property="twitter:description" content="Documentation for NetworkDynamics."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NetworkDynamics</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">General</a></li><li><a class="tocitem" href="../BasicConstructors/">Functions</a></li><li><a class="tocitem" href="../parameters/">Parameter handling</a></li><li><a class="tocitem" href="../Multithreading/">Multi-Threading</a></li><li><a class="tocitem" href="../Library/">Library</a></li><li><a class="tocitem" href="../accessing_edge_variables/">Accessing internal edge values</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_network_dynamics/">Getting started</a></li><li><a class="tocitem" href="../directed_and_weighted_graphs/">Directed and weighted graphs</a></li><li><a class="tocitem" href="../heterogeneous_system/">Heterogeneous systems</a></li><li><a class="tocitem" href="../SDEVertex/">Stochastic differential equations</a></li><li class="is-active"><a class="tocitem" href>Delay differential equations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Delay differential equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Delay differential equations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PIK-ICoNe/NetworkDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/PIK-ICoNe/NetworkDynamics.jl/blob/main/docs/src/kuramoto_delay.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Network-with-time-delays-Kuramoto-model-with-delayed-coupling"><a class="docs-heading-anchor" href="#Network-with-time-delays-Kuramoto-model-with-delayed-coupling">Network with time delays - Kuramoto model with delayed coupling</a><a id="Network-with-time-delays-Kuramoto-model-with-delayed-coupling-1"></a><a class="docs-heading-anchor-permalink" href="#Network-with-time-delays-Kuramoto-model-with-delayed-coupling" title="Permalink"></a></h1><pre><code class="language-julia hljs">using DelayDiffEq
using Random
using Graphs
using NetworkDynamics
using Distributions</code></pre><p>A common modification of the <a href="https://en.wikipedia.org/wiki/Kuramoto_model">Kuramoto model</a> is to include time-lags in the coupling function. In neuroscience this may be used to account for transmission delays along synapses connecting different neurons.</p><p>In this tutorial we solve the system</p><p class="math-container">\[\begin{aligned}
\dot \theta_i(t) = \omega_i + \sum_{j=1}^N \kappa_{ji} (\theta_j(t - \tau_{ji}) - \theta_i(t))
\end{aligned}\]</p><p>where <span>$\kappa_{ji}$</span> denotes the coupling strength of the edge from <span>$j$</span> to <span>$i$</span>, <span>$\tau_{ji}$</span> its time delay and <span>$\theta_j(t - \tau_{ji})$</span> the past state of its source vertex</p><p>For a general introduction to solving delay differential equations in Julia see this <a href="https://docs.sciml.ai/DiffEqDocs/stable/tutorials/dde_example/#Delay-Differential-Equations">tutorial</a>.</p><p>To implement this in NetworkDynamics.jl a <code>StaticDelayEdge</code> has to be defined. Such a coupling function receives two additional arguments <code>h_v_s</code> and <code>h_v_d</code>. These are wrappers of the global history function that directly compute the history values of the local variables at the source and destination vertex respectively. The delay time should be passed like any other parameter. The <code>idxs</code> keyword argument of the history function can be used to access specific local variables.</p><pre><code class="language-julia hljs">function delay_coupling(e, θ_s, θ_d, h_θ_s, h_θ_d, p, t)
    τ, κ = p
    hist1 = h_θ_s(t - τ; idxs=1)
    e[1] = κ * sin(hist1 - θ_d[1])
    return nothing
end

edge = StaticDelayEdge(; f=delay_coupling, dim=1, coupling=:directed);</code></pre><p>The vertex dynamics are simple ODE vertices.</p><pre><code class="language-julia hljs">function kuramoto_vertex(dθ, θ, edges, p, t)
    ω = p
    dθ[1] = ω
    for e in edges
        dθ[1] += e[1]
    end
    return nothing
end

vertex = ODEVertex(; f=kuramoto_vertex, dim=1);</code></pre><p>For this example we use a complete graph. Bear in mind however that the data structures of Network Dynamics are best suited for sparse problems and might introduce some additional overhead for dense graphs.</p><pre><code class="language-julia hljs">N = 6
g = SimpleDiGraph(complete_graph(N))
nd = network_dynamics(vertex, edge, g)

Random.seed!(1)

ω = rand(nv(g)) # internal frequency
τ = rand(ne(g)) # time-lag per edge
κ = rand(ne(g)) # coupling strength per edge
p = (ω, [τ&#39;; κ&#39;])

θ₀ = rand(Uniform(0, 2π), N); # initial conditions</code></pre><p>Define random initial history function</p><pre><code class="language-julia hljs">const past = rand(Uniform(0, 2π), N)
h(p, t; idxs=nothing) = typeof(idxs) &lt;: Number ? past[idxs] : past;</code></pre><p>When constructing the DDEProblem lags may be specified. The solver will then track discontinuities arising from the evaluation of the history function and step to each of the discontinuities. Since each multiplication combination of the lags may be connected to a discontinuity, this may be slow if many different lags are specified.</p><pre><code class="language-julia hljs">prob = DDEProblem(nd, θ₀, h, (0.0, 1.0), p; constant_lags=τ)
@time solve(prob, MethodOfSteps(BS3()); abstol=1e-10, reltol=1e-5); # ~50000 steps because of discontinuities
@time solve(prob, MethodOfSteps(BS3()); abstol=1e-10, reltol=1e-5);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  3.578739 seconds (15.28 M allocations: 795.986 MiB, 5.36% gc time, 88.19% compilation time)
  0.432033 seconds (8.79 M allocations: 415.893 MiB, 22.45% gc time)</code></pre><p>We recommend to solve with lowered absolute and relative error tolerances, since the Kuramoto system is highly multistable and the simulations may else produce very different results.</p><p>The discontinuities arise from the initial history function and quickly get smoothed out (i.e. reduced in order) when the integration time is larger than the maximum lag. If the asymptotic behaviour is more interesting than the correct solution for a specific initial condition, it is possible to trade accuracy for computational speed by leaving the <code>constant_lags</code> undeclared.</p><pre><code class="language-julia hljs">fast_prob = DDEProblem(nd, θ₀, h, (0.0, 1.0), p)
@time solve(fast_prob, MethodOfSteps(BS3()); abstol=1e-10, reltol=1e-5); # ~200 steps
@time solve(fast_prob, MethodOfSteps(BS3()); abstol=1e-10, reltol=1e-5);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  2.048780 seconds (4.79 M allocations: 275.234 MiB, 2.02% gc time, 99.67% compilation time)
  0.010079 seconds (312.64 k allocations: 14.739 MiB)</code></pre><p>The <code>MethodOfSteps</code> algortihm extends an ODE solver to DDEs. For an overview of available solvers consult the manual of DifferentialEquations.jl. For example, for stiff systems, such as this one, it might be beneficial to use a stiff solver such as <code>TRBDF2</code>.</p><pre><code class="language-julia hljs">@time solve(fast_prob, MethodOfSteps(TRBDF2()); abstol=1e-10, reltol=1e-5);
@time solve(fast_prob, MethodOfSteps(TRBDF2()); abstol=1e-10, reltol=1e-5);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  8.676110 seconds (19.41 M allocations: 1.321 GiB, 3.30% gc time, 99.82% compilation time)
  0.011717 seconds (238.61 k allocations: 13.143 MiB)</code></pre><p>Some further helpful comments for dealing within initial discontinuities in DDEs may be found in the <a href="https://jitcdde.readthedocs.io/en/stable/#dealing-with-initial-discontinuities">manual</a> of the Python software JiTCDDE</p><pre><code class="language-julia hljs">using Plots
fast_prob = DDEProblem(nd, θ₀, h, (0.0, 10.0), p)
sol = solve(fast_prob, MethodOfSteps(BS3()); abstol=1e-10, reltol=1e-5, saveat=0.01)
plot(sol; fmt=:png)</code></pre><img src="a9afaf91.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../SDEVertex/">« Stochastic differential equations</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Thursday 25 April 2024 09:24">Thursday 25 April 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

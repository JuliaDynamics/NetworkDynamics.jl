<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parameter handling · NetworkDynamics</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">NetworkDynamics</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">General</a></li><li><a class="tocitem" href="../BasicConstructors/">Functions</a></li><li class="is-active"><a class="tocitem" href>Parameter handling</a><ul class="internal"><li><a class="tocitem" href="#Compatability-with-DiffEqFlux"><span>Compatability with DiffEqFlux</span></a></li></ul></li><li><a class="tocitem" href="../Multithreading/">Multi-Threading</a></li><li><a class="tocitem" href="../Library/">Library</a></li><li><a class="tocitem" href="../accessing_edge_variables/">Accessing internal edge values</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_network_dynamics/">Getting started</a></li><li><a class="tocitem" href="../directed_and_weighted_graphs/">Directed and weighted graphs</a></li><li><a class="tocitem" href="../heterogeneous_system/">Heterogeneous systems</a></li><li><a class="tocitem" href="../SDEVertex/">Stochastic differential equations</a></li><li><a class="tocitem" href="../getting_started_with_DDEs/">Delay differential equations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Parameter handling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parameter handling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/PIK-ICoNe/NetworkDynamics.jl/blob/master/docs/src/parameters.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="parameters"><a class="docs-heading-anchor" href="#parameters">Parameter handling</a><a id="parameters-1"></a><a class="docs-heading-anchor-permalink" href="#parameters" title="Permalink"></a></h1><p>Let <code>nd!</code> be an ODEFunction returned by <code>network_dynamics</code>, e.g.</p><pre><code class="language-julia">nd! = network_dynamics(vertices!, edges!, graph)</code></pre><p>then the behaviour of <code>nd!</code> has the signature <code>(dx, x, t, p)</code> and its behaviour changes with the type of parameters <code>p</code> being passed.</p><ul><li>When <code>p</code> is an Array, a Dict, a struct... then the entire object is passed to each <code>VertexFunction</code> and <code>EdgeFunction</code>.</li><li>When <code>p = (p_v, p_e)</code> is a Tuple of two values, then the first value will be passed to all vertices and the second to all edges.</li><li>If <code>p = (p_v_arr, p_e_arr)</code> is a Tuple of two Arrays with lengths corresponding to the number of nodes and number of edges respectively, then the edges or nodes receive only the parameter with the corresponding index.</li><li>If all nodes and/or edges have no internal parameters the value <code>nothing</code> may be passed. Using <code>nothing</code> instead of dummy parameters is usually faster, since then less data are copied.</li><li>If you are working with delay differential equations the parameter tuple should have a third entry that specifies the delay time, <code>p = (p_v, p_e, delay_time)</code>.</li></ul><p>Another option for specifying heterogeneous parameters is to make each <code>VertexFunction</code> a callable struct with the parameters hardcoded as fields. This approach is used in <a href="https://github.com/JuliaEnergy/PowerDynamics.jl">PowerDynamics.jl</a>. However it provides considerably less flexibility and interoperability with other packages.</p><p>For its greater speed and flexibility in modeling we recommend to use the tuple syntax.</p><h2 id="Compatability-with-DiffEqFlux"><a class="docs-heading-anchor" href="#Compatability-with-DiffEqFlux">Compatability with DiffEqFlux</a><a id="Compatability-with-DiffEqFlux-1"></a><a class="docs-heading-anchor-permalink" href="#Compatability-with-DiffEqFlux" title="Permalink"></a></h2><p>Most of the sensitivity algorithms that DiffEqFlux makes use of assume that the parameters <code>p</code> are a subtype of <code>AbstractArray</code>. Therefore they are not compatible with the tuple syntax.<code>TrackerAdjoint</code> does not have these limitations but works best on out-of-place problems. Unfortunately, <code>network_dynamics</code> returns an ODEProblem that is in-place (mutating its inputs) leading to slow performance with Tracker.</p><p>However, wrapping the function in such a way that it accepts arrays of parameters that are later pasted into the tuple syntax sidesteps these issues and enables the use of adjoint methods. Depending on the use case such a wrapper might look like this:</p><pre><code class="language-julia">function nd_wrapper!(dx, x, p, t)
  nd!(dx, x, (p, nothing), t)
end</code></pre><p><code>nd_wrapper!</code> should now work with <code>BacksolveAdjoint</code> and <code>InterpolatingAdjoint</code>. At the moment we recommend this way for combining NetworDynamics and DiffEqFlux.</p><p>Forward mode (ForwardDiff.jl) and source-to-source (Zygote.jl)  automatic differentiation  is not fully-supported yet. For more detailed discussion see <a href="https://github.com/pik-icone/NetworkDynamics.jl/issues/34">this issue</a>.</p><p>Further resources:</p><ul><li><a href="https://diffeq.sciml.ai/stable/analysis/sensitivity/">DiffEqSensitivity algorithms</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../BasicConstructors/">« Functions</a><a class="docs-footer-nextpage" href="../Multithreading/">Multi-Threading »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 1 October 2021 09:47">Friday 1 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
